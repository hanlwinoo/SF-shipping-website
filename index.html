<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SF Shipping - Track Your Package</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ===== Base Styles ===== */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Arial', sans-serif; }
        body { background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); overflow: hidden; }
        
        /* ===== Header Styles ===== */
        header { background: linear-gradient(to right, #1a2980, #26d0ce); color: white; padding: 30px 40px; text-align: center; }
        .logo-container { display: flex; align-items: center; justify-content: center; gap: 20px; margin-bottom: 10px; }
        .sf-logo { width: 80px; height: 80px; border-radius: 50%; object-fit: contain; border: 3px solid white; cursor: pointer; transition: 0.3s; background: white; padding: 5px; }
        .sf-logo:hover { transform: scale(1.05); box-shadow: 0 0 20px rgba(255,255,255,0.5); }
        h1 { font-size: 2.8rem; font-weight: 700; letter-spacing: 1px; }
        .tagline { font-size: 1.2rem; opacity: 0.9; margin-top: 10px; }
        
        /* ===== Main Content ===== */
        main { padding: 40px; }
        .tracking-section { background: #f8f9fa; border-radius: 10px; padding: 30px; margin-bottom: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        h2 { color: #1a2980; margin-bottom: 25px; display: flex; align-items: center; gap: 10px; font-size: 1.8rem; }
        
        /* ===== Form Styles ===== */
        .tracking-form { max-width: 600px; margin: 0 auto; }
        .form-group { margin-bottom: 25px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; display: flex; align-items: center; gap: 8px; }
        input { width: 100%; padding: 14px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; transition: 0.3s; }
        input:focus { border-color: #26d0ce; outline: none; box-shadow: 0 0 0 3px rgba(38,208,206,0.2); }
        .hint { display: block; margin-top: 5px; color: #666; font-size: 0.9rem; }
        
        /* ===== Button Styles ===== */
        .track-btn, .new-search-btn, .login-btn { background: linear-gradient(to right, #1a2980, #26d0ce); color: white; border: none; padding: 16px 30px; border-radius: 8px; font-size: 18px; font-weight: 600; cursor: pointer; transition: 0.3s; width: 100%; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .track-btn:hover, .new-search-btn:hover, .login-btn:hover { transform: translateY(-2px); box-shadow: 0 7px 20px rgba(26,41,128,0.2); }
        .new-search-btn { max-width: 300px; margin: 30px auto 0; background: linear-gradient(to right, #667eea, #764ba2); }
        
        /* ===== Result Section ===== */
        .result-section { background: #f8f9fa; border-radius: 10px; padding: 30px; margin-bottom: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .shipment-info { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px; margin-top: 20px; }
        .info-card { background: white; border-radius: 10px; padding: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); border-top: 4px solid #26d0ce; }
        .info-card.full-width { grid-column: 1 / -1; }
        .info-card h3 { color: #1a2980; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; font-size: 1.3rem; }
        .info-grid { display: flex; flex-direction: column; gap: 15px; }
        .info-item { display: flex; justify-content: space-between; padding-bottom: 12px; border-bottom: 1px solid #eee; }
        .label { font-weight: 600; color: #555; min-width: 160px; }
        .value { color: #333; text-align: right; flex: 1; word-break: break-word; }
        .status { background-color: #e3f2fd; color: #1a2980; padding: 5px 12px; border-radius: 20px; font-weight: 600; display: inline-block; }
        
        /* ===== Timeline ===== */
        .timeline { position: relative; padding-left: 30px; }
        .timeline::before { content: ''; position: absolute; left: 10px; top: 0; bottom: 0; width: 2px; background-color: #26d0ce; }
        .timeline-item { position: relative; margin-bottom: 25px; padding-left: 20px; }
        .timeline-item::before { content: ''; position: absolute; left: -10px; top: 5px; width: 12px; height: 12px; border-radius: 50%; background-color: #1a2980; border: 2px solid white; box-shadow: 0 0 0 3px #26d0ce; }
        .timeline-date { font-weight: 600; color: #1a2980; font-size: 0.9rem; }
        .timeline-content { color: #333; margin-top: 5px; font-weight: 500; }
        .timeline-location { color: #666; font-style: italic; margin-top: 3px; }
        
        /* ===== Error Message ===== */
        .error-message { background-color: #fee; border-left: 4px solid #f44336; padding: 20px; border-radius: 8px; color: #c62828; font-weight: 600; text-align: center; margin-top: 20px; }
        
        /* ===== Footer ===== */
        footer { background-color: #f8f9fa; padding: 20px; text-align: center; color: #666; border-top: 1px solid #eee; }
        .footer-note { font-size: 0.9rem; margin-top: 5px; color: #888; }
        
        /* ===== Modal Styles ===== */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
        .modal-content { background: white; margin: 10% auto; padding: 0; width: 90%; max-width: 500px; border-radius: 10px; box-shadow: 0 15px 30px rgba(0,0,0,0.2); }
        .modal-header { background: linear-gradient(to right, #1a2980, #26d0ce); color: white; padding: 20px 30px; border-radius: 10px 10px 0 0; display: flex; justify-content: space-between; align-items: center; }
        .modal-header h2 { color: white; margin: 0; font-size: 1.5rem; }
        .close { font-size: 28px; cursor: pointer; transition: 0.3s; }
        .close:hover { color: #ffeb3b; }
        .modal-body { padding: 30px; }
        .error-field { color: #f44336; font-size: 0.9rem; margin-top: 5px; min-height: 20px; }
        
        /* ===== QR Scan Hint ===== */
        .qr-scan-hint { background: #e8f4fc; border-left: 4px solid #2196F3; padding: 15px; border-radius: 8px; margin-top: 20px; display: flex; align-items: center; gap: 10px; }
        .qr-scan-hint i { color: #2196F3; font-size: 1.2rem; }
        
        /* ===== Responsive ===== */
        @media (max-width: 768px) {
            .container { border-radius: 0; margin: -20px; }
            header { padding: 20px; }
            h1 { font-size: 2rem; }
            main { padding: 20px; }
            .shipment-info { grid-template-columns: 1fr; }
            .info-item { flex-direction: column; gap: 5px; }
            .value { text-align: left; }
        }
        
        .logo-hint {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            white-space: nowrap;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .logo-container:hover .logo-hint { opacity: 1; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo-container">
                <div style="position: relative;">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/66/Logo_of_SF_Express.svg/1280px-Logo_of_SF_Express.svg.png" 
                         alt="SF Shipping Logo" class="sf-logo" id="adminLogo">
                    <div class="logo-hint">Double click for admin access</div>
                </div>
                <h1>SF Shipping</h1>
            </div>
            <p class="tagline">Reliable Global Logistics Solutions</p>
        </header>

        <main>
            <div class="tracking-section">
                <h2><i class="fas fa-search-location"></i> Track Your Shipment</h2>
                <div class="tracking-form">
                    <div class="form-group">
                        <label for="trackingNumber"><i class="fas fa-barcode"></i> Tracking Number</label>
                        <input type="text" id="trackingNumber" placeholder="Enter SF tracking number (e.g., SF123456789)" maxlength="11">
                        <small class="hint">Format: SF followed by 9 digits</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="confirmationCode"><i class="fas fa-shield-alt"></i> Confirmation Code</label>
                        <input type="text" id="confirmationCode" placeholder="Enter 4-digit confirmation code" maxlength="4">
                        <small class="hint">4 random letters/numbers provided when shipment was created</small>
                    </div>
                    
                    <button id="trackButton" class="track-btn">
                        <i class="fas fa-search"></i> Track Shipment
                    </button>
                    
                    <div class="qr-scan-hint">
                        <i class="fas fa-qrcode"></i>
                        <div>
                            <strong>QR Code Scan:</strong> You can also scan the QR code provided by admin to track your shipment directly.
                        </div>
                    </div>
                </div>
            </div>

            <div class="result-section" id="resultSection" style="display: none;">
                <h2><i class="fas fa-shipping-fast"></i> Shipment Details</h2>
                <div class="shipment-info">
                    <!-- Shipment details will be loaded here -->
                </div>
                
                <button id="newSearchButton" class="new-search-btn">
                    <i class="fas fa-redo"></i> Track Another Shipment
                </button>
            </div>

            <div class="error-message" id="errorMessage" style="display: none;"></div>
        </main>

        <footer>
            <p>© 2024 SF Shipping. All rights reserved.</p>
            <p class="footer-note">For shipment booking, please contact our customer service.</p>
        </footer>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-lock"></i> Admin Authentication</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="username"><i class="fas fa-user"></i> Username</label>
                    <input type="text" id="username" placeholder="Enter username">
                    <div class="error-field" id="usernameError"></div>
                </div>
                <div class="form-group">
                    <label for="password"><i class="fas fa-key"></i> Password</label>
                    <input type="password" id="password" placeholder="Enter password">
                    <div class="error-field" id="passwordError"></div>
                </div>
                <button id="loginButton" class="login-btn">
                    <i class="fas fa-sign-in-alt"></i> Login to Admin Panel
                </button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script>
        // ==================== QR CODE AUTO-FILL ====================
        // Check URL for QR code parameters and auto-fill
        function checkQRCodeParameters() {
            const urlParams = new URLSearchParams(window.location.search);
            const track = urlParams.get('track');
            const code = urlParams.get('code');
            
            if (track && code) {
                // Fill the form automatically
                document.getElementById('trackingNumber').value = track;
                document.getElementById('confirmationCode').value = code;
                
                // Show notification
                setTimeout(() => {
                    alert('✅ Tracking information loaded from QR code!\n\nClick "Track Shipment" button to view details.');
                }, 500);
                
                // Auto-track after 1 second
                setTimeout(() => {
                    document.getElementById('trackButton').click();
                }, 1000);
            }
        }
        
        // Run when page loads
        window.addEventListener('load', checkQRCodeParameters);
        
        // ==================== FIREBASE CONFIG ====================
        const firebaseConfig = {
            apiKey: "AIzaSyD123abc456def789ghi",
            authDomain: "logstic-system.firebaseapp.com",
            databaseURL: "https://logstic-system-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "logstic-system",
            storageBucket: "logstic-system.appspot.com",
            messagingSenderId: "929186977018",
            appId: "1:929186977018:web:342a2cf9454f03c8e0a543"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Admin credentials
        const ADMIN_USERNAME = "hanlwinoo";
        const ADMIN_PASSWORD = "1500love";

        // DOM Elements
        const trackingNumberInput = document.getElementById('trackingNumber');
        const confirmationCodeInput = document.getElementById('confirmationCode');
        const trackButton = document.getElementById('trackButton');
        const resultSection = document.getElementById('resultSection');
        const errorMessage = document.getElementById('errorMessage');
        const adminLogo = document.getElementById('adminLogo');
        const loginModal = document.getElementById('loginModal');
        const closeModal = document.querySelector('.close');
        const loginButton = document.getElementById('loginButton');
        const newSearchButton = document.getElementById('newSearchButton');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const usernameError = document.getElementById('usernameError');
        const passwordError = document.getElementById('passwordError');

        // Double click handler for logo
        let logoClickCount = 0;
        let logoClickTimer;

        if (adminLogo) {
            adminLogo.addEventListener('click', function() {
                logoClickCount++;
                
                if (logoClickCount === 1) {
                    logoClickTimer = setTimeout(() => {
                        logoClickCount = 0;
                    }, 500);
                } else if (logoClickCount === 2) {
                    clearTimeout(logoClickTimer);
                    logoClickCount = 0;
                    openLoginModal();
                }
            });
        }

        // Tracking function
        async function trackShipment() {
            const trackingNumber = trackingNumberInput.value.trim().toUpperCase();
            const confirmationCode = confirmationCodeInput.value.trim().toUpperCase();

            // Reset errors
            errorMessage.style.display = 'none';
            resultSection.style.display = 'none';

            // Validation
            if (!trackingNumber || !confirmationCode) {
                showError("Please enter both tracking number and confirmation code.");
                return;
            }

            if (!trackingNumber.match(/^SF\d{9}$/)) {
                showError("Invalid tracking number format. Please use SF followed by 9 digits.");
                return;
            }

            if (!confirmationCode.match(/^[A-Z0-9]{4}$/)) {
                showError("Invalid confirmation code format. Please enter exactly 4 letters/numbers.");
                return;
            }

            try {
                trackButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Tracking...';
                trackButton.disabled = true;

                const shipmentRef = database.ref('shipments/' + trackingNumber);
                const snapshot = await shipmentRef.once('value');

                if (!snapshot.exists()) {
                    showError("Shipment not found. Please check your tracking number.");
                    trackButton.innerHTML = '<i class="fas fa-search"></i> Track Shipment';
                    trackButton.disabled = false;
                    return;
                }

                const shipment = snapshot.val();

                if (!shipment.confirmationCode || shipment.confirmationCode !== confirmationCode) {
                    showError("Invalid confirmation code. Please check and try again.");
                    trackButton.innerHTML = '<i class="fas fa-search"></i> Track Shipment';
                    trackButton.disabled = false;
                    return;
                }

                // Display shipment information
                displayShipmentInfo(shipment, trackingNumber);
                resultSection.style.display = 'block';

                // Listen for real-time updates
                shipmentRef.on('value', (snap) => {
                    if (snap.exists()) {
                        displayShipmentInfo(snap.val(), trackingNumber);
                    }
                });

                trackButton.innerHTML = '<i class="fas fa-search"></i> Track Shipment';
                trackButton.disabled = false;

            } catch (error) {
                console.error("Tracking error:", error);
                showError("An error occurred while tracking your shipment. Please try again.");
                trackButton.innerHTML = '<i class="fas fa-search"></i> Track Shipment';
                trackButton.disabled = false;
            }
        }

        function displayShipmentInfo(shipment, trackingNumber) {
            const shipmentInfoHTML = `
                <div class="info-card">
                    <h3><i class="fas fa-info-circle"></i> Shipment Information</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="label">Tracking Number:</span>
                            <span class="value">${trackingNumber}</span>
                        </div>
                        <div class="info-item">
                            <span class="label">Status:</span>
                            <span class="value status">${shipment.status || 'Pending'}</span>
                        </div>
                        <div class="info-item">
                            <span class="label">Origin:</span>
                            <span class="value">${shipment.origin || 'Not specified'}</span>
                        </div>
                        <div class="info-item">
                            <span class="label">Destination:</span>
                            <span class="value">${shipment.destination || 'Not specified'}</span>
                        </div>
                        <div class="info-item">
                            <span class="label">Confirmation Code:</span>
                            <span class="value">${shipment.confirmationCode || 'N/A'}</span>
                        </div>
                    </div>
                </div>

                <div class="info-card">
                    <h3><i class="fas fa-user"></i> Sender Details</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="label">Name:</span>
                            <span class="value">${shipment.sender?.name || 'Not specified'}</span>
                        </div>
                    </div>
                </div>

                <div class="info-card">
                    <h3><i class="fas fa-user-check"></i> Receiver Details</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="label">Name:</span>
                            <span class="value">${shipment.receiver?.name || 'Not specified'}</span>
                        </div>
                        <div class="info-item">
                            <span class="label">Address:</span>
                            <span class="value">${shipment.receiver?.address || 'Not specified'}</span>
                        </div>
                        <div class="info-item">
                            <span class="label">Phone:</span>
                            <span class="value">${shipment.receiver?.phone || 'Not specified'}</span>
                        </div>
                    </div>
                </div>

                <div class="info-card full-width">
                    <h3><i class="fas fa-route"></i> Tracking History</h3>
                    <div class="timeline" id="trackingTimeline">
                        ${generateTimelineHTML(shipment.trackingHistory || [], shipment.origin)}
                    </div>
                </div>
            `;
            
            document.querySelector('.shipment-info').innerHTML = shipmentInfoHTML;
        }

        function generateTimelineHTML(trackingHistory, origin) {
            if (trackingHistory.length === 0) {
                return `
                    <div class="timeline-item">
                        <div class="timeline-date">${new Date().toLocaleDateString('en-US', { 
                            year: 'numeric', 
                            month: 'short', 
                            day: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        })}</div>
                        <div class="timeline-content">Shipment created</div>
                        <div class="timeline-location">${origin || 'Origin'}</div>
                    </div>
                `;
            }
            
            return trackingHistory.map(event => `
                <div class="timeline-item">
                    <div class="timeline-date">${event.date || new Date().toLocaleDateString()}</div>
                    <div class="timeline-content">${event.description || 'Tracking update'}</div>
                    <div class="timeline-location">${event.location || 'Location not specified'}</div>
                </div>
            `).join('');
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
        }

        function newSearch() {
            trackingNumberInput.value = '';
            confirmationCodeInput.value = '';
            resultSection.style.display = 'none';
            errorMessage.style.display = 'none';
            trackingNumberInput.focus();
        }

        // Admin login functions
        function openLoginModal() {
            loginModal.style.display = 'block';
            usernameInput.value = '';
            passwordInput.value = '';
            usernameError.textContent = '';
            passwordError.textContent = '';
            setTimeout(() => usernameInput.focus(), 100);
        }

        function closeLoginModal() {
            loginModal.style.display = 'none';
        }

        function loginToAdmin() {
            const username = usernameInput.value.trim();
            const password = passwordInput.value.trim();
            
            // Reset errors
            usernameError.textContent = '';
            passwordError.textContent = '';
            
            let hasError = false;
            
            if (username !== ADMIN_USERNAME) {
                usernameError.textContent = "Incorrect username";
                hasError = true;
            }
            
            if (password !== ADMIN_PASSWORD) {
                passwordError.textContent = "Incorrect password";
                hasError = true;
            }
            
            if (!hasError) {
                localStorage.setItem('sfAdminAuth', 'true');
                window.location.href = 'admin.html';
            }
        }

        // Event listeners
        if (trackButton) trackButton.addEventListener('click', trackShipment);
        if (newSearchButton) newSearchButton.addEventListener('click', newSearch);
        if (closeModal) closeModal.addEventListener('click', closeLoginModal);
        if (loginButton) loginButton.addEventListener('click', loginToAdmin);

        // Close modal when clicking outside
        window.addEventListener('click', (event) => {
            if (event.target === loginModal) {
                closeLoginModal();
            }
        });

        // Enter key support
        if (trackingNumberInput) {
            trackingNumberInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    confirmationCodeInput.focus();
                }
            });
        }

        if (confirmationCodeInput) {
            confirmationCodeInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    trackShipment();
                }
            });
        }

        // Focus on tracking number when page loads
        window.addEventListener('load', () => {
            if (trackingNumberInput) {
                trackingNumberInput.focus();
            }
        });
    </script>
</body>
</html>
